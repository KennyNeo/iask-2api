<div align="center">

# âœ¨ iask-2api (çœŸç†Â·ç»ˆç« ) âœ¨

<img src="https://img.shields.io/badge/version-6.0.0-blue.svg" alt="Version">
<img src="https://img.shields.io/badge/license-Apache_2.0-green.svg" alt="License">
<img src="https://img.shields.io/badge/status-stable-brightgreen.svg" alt="Status">
<img src="https://img.shields.io/badge/made_with-love_&_python-red.svg" alt="Made with Love & Python">
<img src="https://img.shields.io/badge/docker-ready-blue.svg?logo=docker" alt="Docker Ready">

**å°† [iask.ai](https://iask.ai/) è½¬æ¢ä¸ºå…¼å®¹ OpenAI æ ¼å¼ API çš„é«˜æ€§èƒ½åŒ¿åä»£ç†**

**"æˆ‘ä»¬å¹¶éåœ¨åˆ›é€ æ–°çš„æ™ºæ…§ï¼Œè€Œæ˜¯åœ¨æ­å»ºæ¡¥æ¢ï¼Œè®©å·²å­˜åœ¨çš„æ™ºæ…§ä¹‹å…‰ï¼Œç…§äº®æ›´å¤šè¢«éš”ç»çš„è§’è½ã€‚"**

</div>

---

## ğŸ“œ ç›®å½•

- [ğŸŒŸ æ ¸å¿ƒå“²å­¦](#-æ ¸å¿ƒå“²å­¦)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ğŸ¯ é¡¹ç›®ç‰¹æ€§](#-é¡¹ç›®ç‰¹æ€§)
- [ğŸ¤– æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„)
- [ğŸ“ˆ é¡¹ç›®ç°çŠ¶ä¸æœªæ¥è§„åˆ’](#-é¡¹ç›®ç°çŠ¶ä¸æœªæ¥è§„åˆ’)
- [ğŸ’¡ å¼€å‘è€…æŒ‡å—](#-å¼€å‘è€…æŒ‡å—)
- [ğŸ“„ å¼€æºåè®®](#-å¼€æºåè®®)

---

## ğŸŒŸ æ ¸å¿ƒå“²å­¦

åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½åƒæ˜¯æ¼‚æµ®åœ¨çŸ¥è¯†æµ·æ´‹ä¸­çš„å­¤å²›ã€‚`iask-2api` çš„è¯ç”Ÿï¼Œæºäºä¸€ä¸ªçº¯ç²¹è€Œå¼ºå¤§çš„ä¿¡å¿µï¼š**æ‰“ç ´å£å’ï¼Œèµ‹èƒ½åˆ›é€ **ã€‚

### æˆ‘ä»¬çš„ä»·å€¼è§‚

- **å¼€æ”¾ (Openness) ğŸ‘**ï¼šé€šè¿‡å°† `iask.ai` å°è£…æˆæ ‡å‡†çš„ OpenAI APIï¼Œæˆ‘ä»¬ä¸ºæ— æ•°ç°æœ‰çš„åº”ç”¨å’Œå¼€å‘è€…æ‰“å¼€äº†ä¸€æ‰‡æ–°çš„å¤§é—¨ã€‚
- **ä¾¿æ· (Convenience) ğŸ•Šï¸**ï¼šå¤æ‚æ€§åº”è¯¥ç•™ç»™ä»£ç ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ã€‚æˆ‘ä»¬è¿½æ±‚æè‡´çš„"å¼€ç®±å³ç”¨"ä½“éªŒã€‚
- **é¼“åŠ± (Encouragement) ğŸ’ª**ï¼šæˆ‘ä»¬å¸Œæœ›æ¿€å‘ä½ å†…å¿ƒæ·±å¤„çš„åˆ›é€ æ¬²å’Œæ¢ç´¢ç²¾ç¥ï¼Œè®©ä½ ç›¸ä¿¡"æˆ‘æ¥æˆ‘ä¹Ÿè¡Œ"ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶
- å®‰è£… [Docker](https://www.docker.com/get-started) å’Œ [Docker Compose](https://docs.docker.com/compose/install/)

### ä¸‰æ­¥éƒ¨ç½²

**1. å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/lzA6/iask-2api.git
cd iask-2api
```

**2. é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„ API å¯†é’¥å’Œç«¯å£
```

**3. å¯åŠ¨æœåŠ¡**
```bash
docker-compose up -d
```

### éªŒè¯éƒ¨ç½²
```bash
curl http://localhost:8088/v1/models -H "Authorization: Bearer your-super-secret-key"
```

å¦‚æœè¿”å› JSON æ ¼å¼çš„æ¨¡å‹åˆ—è¡¨ï¼Œæ­å–œä½ éƒ¨ç½²æˆåŠŸï¼ğŸ‰

---

## ğŸ¯ é¡¹ç›®ç‰¹æ€§

### âœ… æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | æè¿° | å—ç›Šåœºæ™¯ |
|------|------|----------|
| **æ— ç¼é›†æˆ** ğŸ§© | å°† iask.ai è½¬æ¢ä¸ºæ ‡å‡† OpenAI API æ ¼å¼ | å…¼å®¹æ‰€æœ‰æ”¯æŒ OpenAI çš„å®¢æˆ·ç«¯å’Œåº“ |
| **æè‡´ä¾¿æ·** ğŸ’¨ | Docker ä¸€é”®éƒ¨ç½²ï¼Œæ— éœ€ç¯å¢ƒé…ç½® | å°ç™½ç”¨æˆ·å‹å¥½ï¼Œå¿«é€Ÿä¸Šæ‰‹ |
| **åŒ¿åè®¿é—®** ğŸ•µï¸ | æ— éœ€ç™»å½•æˆ–æä¾› Cookie | ä¿æŠ¤ç”¨æˆ·éšç§ï¼Œç®€åŒ–é…ç½® |
| **é«˜æ€§èƒ½æµå¼å“åº”** ğŸ’§ | å­—ç¬¦çº§å¢é‡æµå¼è¾“å‡º | å®æ—¶å“åº”ï¼Œä½“éªŒåª²ç¾åŸç”Ÿæ¨¡å‹ |

### âš ï¸ å±€é™æ€§

| é™åˆ¶ | å½±å“ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **å‰ç«¯ä¾èµ–** ğŸ•¸ï¸ | iask.ai å‰ç«¯æ”¹ç‰ˆå¯èƒ½å¯¼è‡´å¤±æ•ˆ | éœ€è¦åŠæ—¶æ›´æ–°é€‰æ‹©å™¨ |
| **èµ„æºæ¶ˆè€—** ğŸ˜ | æµè§ˆå™¨å®ä¾‹å ç”¨è¾ƒå¤šèµ„æº | å»ºè®®é€‚å½“é…ç½®æœåŠ¡å™¨ |
| **æ½œåœ¨ä¸ç¨³å®šæ€§** ğŸ² | å¯èƒ½é‡åˆ°åçˆ¬è™«æœºåˆ¶ | æœªæ¥é›†æˆååçˆ¬è™«æŠ€æœ¯ |

---

## ğŸ¤– æŠ€æœ¯æ¶æ„

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    A[å®¢æˆ·ç«¯] --> B{Nginx<br/>åå‘ä»£ç†}
    B --> C[FastAPI<br/>Webæ¡†æ¶]
    C --> D[iask-2api<br/>æ ¸å¿ƒæœåŠ¡]
    D --> E[Playwright<br/>æµè§ˆå™¨è‡ªåŠ¨åŒ–]
    E --> F[iask.ai<br/>ç›®æ ‡ç½‘ç«™]
    
    D --> G[SSEæµå¼å“åº”]
    G --> C
    C --> B
    B --> A
    
    subgraph "æ ¸å¿ƒå¤„ç†æµç¨‹"
        H[è¯·æ±‚æ¥æ”¶] --> I[è®¤è¯éªŒè¯]
        I --> J[å‚æ•°è§£æ]
        J --> K[æµè§ˆå™¨æ¨¡æ‹Ÿ]
        K --> L[å†…å®¹æŠ“å–]
        L --> M[å®æ—¶æ¸…ç†]
        M --> N[æµå¼è¿”å›]
    end
```

### ğŸ“ é¡¹ç›®ç»“æ„

```
iask-2api/
â”œâ”€â”€ ğŸ³ Dockerfile              # å®¹å™¨åŒ–é…ç½®
â”œâ”€â”€ ğŸ³ docker-compose.yml      # æœåŠ¡ç¼–æ’
â”œâ”€â”€ ğŸ”§ nginx.conf              # Nginx é…ç½®
â”œâ”€â”€ ğŸ“„ main.py                 # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ ğŸ“„ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ ğŸ“„ .env.example            # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ ğŸ“‚ app/                    # æ ¸å¿ƒä»£ç 
    â”œâ”€â”€ ğŸ“‚ core/
    â”‚   â””â”€â”€ ğŸ“„ config.py       # é…ç½®ç®¡ç†
    â”œâ”€â”€ ğŸ“‚ providers/
    â”‚   â”œâ”€â”€ ğŸ“„ base_provider.py # æŠ½è±¡åŸºç±»
    â”‚   â””â”€â”€ ğŸ“„ iask_provider.py # iask.ai å®ç°
    â””â”€â”€ ğŸ“‚ utils/
        â””â”€â”€ ğŸ“„ sse_utils.py    # æµå¼å“åº”å·¥å…·
```

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” | é€‰æ‹©ç†ç”± |
|----------|------|------|----------|
| **FastAPI** | 0.104+ | Web API æ¡†æ¶ | é«˜æ€§èƒ½ï¼ŒåŸç”Ÿå¼‚æ­¥ï¼Œè‡ªåŠ¨æ–‡æ¡£ |
| **Playwright** | 1.40+ | æµè§ˆå™¨è‡ªåŠ¨åŒ– | ç°ä»£åŒ– APIï¼Œæ›´å¥½çš„å¼‚æ­¥æ”¯æŒ |
| **Docker** | 20.10+ | å®¹å™¨åŒ–éƒ¨ç½² | ç¯å¢ƒä¸€è‡´æ€§ï¼Œç®€åŒ–éƒ¨ç½² |
| **Nginx** | 1.24+ | åå‘ä»£ç† | é«˜æ€§èƒ½ï¼Œæµå¼ä¼ è¾“ä¼˜åŒ– |

### ğŸ¯ æ ¸å¿ƒå·¥ä½œæµç¨‹

1. **è¯·æ±‚æ¥æ”¶** ğŸ“¥ - FastAPI æ¥æ”¶ OpenAI æ ¼å¼è¯·æ±‚
2. **è®¤è¯éªŒè¯** ğŸ” - éªŒè¯ API Key æœ‰æ•ˆæ€§
3. **æµè§ˆå™¨å¯åŠ¨** ğŸš€ - Playwright å¯åŠ¨æ— å¤´æµè§ˆå™¨
4. **é¡µé¢è®¿é—®** ğŸŒ - è®¿é—® iask.ai å¹¶æäº¤æŸ¥è¯¢
5. **å®æ—¶ç›‘æ§** ğŸ‘€ - ç›‘å¬ DOM å˜åŒ–ï¼Œæ•è·å¢é‡å†…å®¹
6. **å†…å®¹æ¸…ç†** ğŸ§¹ - ç§»é™¤å¹¿å‘Šï¼Œè½¬æ¢æ ¼å¼
7. **æµå¼è¿”å›** ğŸ“¤ - SSE æ ¼å¼å®æ—¶è¿”å›ç»“æœ

### ğŸ’¡ å…³é”®æŠ€æœ¯å®ç°

#### å­—ç¬¦çº§æµå¼è¾“å‡º
```python
async def stream_answer(self, question: str, model: str):
    """å®ç°å­—ç¬¦çº§å¢é‡æµå¼è¾“å‡º"""
    async with async_playwright() as p:
        browser = await p.chromium.launch()
        page = await browser.new_page()
        
        # è®¿é—®ç›®æ ‡é¡µé¢
        await page.goto(self._build_url(question, model))
        
        last_text = ""
        while True:
            # å®æ—¶è·å–æœ€æ–°å†…å®¹
            current_text = await page.inner_html('#text')
            
            # è®¡ç®—å¢é‡å†…å®¹
            new_text = current_text[len(last_text):]
            if new_text:
                # æ¸…ç†å¹¶è¿”å›å¢é‡
                cleaned = self._clean_text_chunk(new_text)
                yield cleaned
                last_text = current_text
            
            # æ£€æŸ¥æ˜¯å¦ç»“æŸ
            if await page.is_visible('#relatedQuestions'):
                break
            
            await asyncio.sleep(0.1)
```

#### Nginx æµå¼ä¼˜åŒ–
```nginx
# å…³é”®é…ç½®ï¼šå…³é—­ä»£ç†ç¼“å†²ï¼Œå®ç°çœŸÂ·æµå¼
location / {
    proxy_pass http://iask_backend;
    proxy_buffering off;           # ğŸ”‘ å…³é”®é…ç½®
    proxy_cache off;
    chunked_transfer_encoding on;
}
```

---

## ğŸ“ˆ é¡¹ç›®ç°çŠ¶ä¸æœªæ¥è§„åˆ’

### âœ… å·²å®ç°åŠŸèƒ½ (v6.0.0)

- [x] **å®Œæ•´ API å…¼å®¹** - æ”¯æŒ OpenAI `v1/chat/completions` æ¥å£
- [x] **å­—ç¬¦çº§æµå¼å“åº”** - å®æ—¶å¢é‡è¾“å‡ºï¼Œä½“éªŒä¼˜ç§€
- [x] **å¤šæ¨¡å‹æ”¯æŒ** - æ”¯æŒ iask.ai å„ç§æœç´¢æ¨¡å¼
- [x] **ä¸€é”®éƒ¨ç½²** - Docker Compose å®Œæ•´è§£å†³æ–¹æ¡ˆ
- [x] **å®‰å…¨è®¤è¯** - API Key ä¿æŠ¤æœºåˆ¶
- [x] **æ™ºèƒ½æ¸…ç†** - è‡ªåŠ¨ç§»é™¤å¹¿å‘Šï¼Œä¼˜åŒ–æ ¼å¼

### ğŸš§ å¼€å‘è·¯çº¿å›¾

#### çŸ­æœŸç›®æ ‡ (v6.1.0)
- [ ] å¢å¼ºé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] ä¼˜åŒ–æµè§ˆå™¨èµ„æºç®¡ç†

#### ä¸­æœŸç›®æ ‡ (v7.0.0)  
- [ ] å¤š Provider æ”¯æŒ (Bingã€Google ç­‰)
- [ ] è´Ÿè½½å‡è¡¡å’Œå®ä¾‹æ± 
- [ ] è¯·æ±‚é™æµå’Œé…é¢ç®¡ç†

#### é•¿æœŸæ„¿æ™¯
- [ ] å¯è§†åŒ–ç›‘æ§é¢æ¿
- [ ] æ’ä»¶åŒ–æ¶æ„
- [ ] äº‘åŸç”Ÿéƒ¨ç½²æ”¯æŒ

### ğŸ› å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

| é—®é¢˜ | å½±å“ç¨‹åº¦ | ä¸´æ—¶è§£å†³æ–¹æ¡ˆ | é•¿æœŸè§„åˆ’ |
|------|----------|--------------|----------|
| å‰ç«¯é€‰æ‹©å™¨å˜æ›´ | é«˜ | æ‰‹åŠ¨æ›´æ–°é€‰æ‹©å™¨ | è‡ªé€‚åº”é€‰æ‹©å™¨ |
| éªŒè¯ç æ‹¦æˆª | ä¸­ | æ‰‹åŠ¨éªŒè¯ | é›†æˆéªŒè¯ç æœåŠ¡ |
| é«˜å¹¶å‘é™åˆ¶ | ä¸­ | å¢åŠ èµ„æº | æµè§ˆå™¨å®ä¾‹æ±  |

---

## ğŸ’¡ å¼€å‘è€…æŒ‡å—

### ğŸ› ï¸ å¿«é€Ÿå¼€å‘è®¾ç½®

**1. æœ¬åœ°å¼€å‘ç¯å¢ƒ**
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/lzA6/iask-2api.git
cd iask-2api

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å®‰è£… Playwright æµè§ˆå™¨
playwright install chromium

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**2. è°ƒè¯•æ¨¡å¼**
```bash
# è®¾ç½®è°ƒè¯•ç¯å¢ƒå˜é‡
export DEBUG=true
export API_MASTER_KEY=your-test-key

# å¯åŠ¨æœåŠ¡
python main.py
```

### ğŸ” æ ¸å¿ƒä¿®æ”¹ç‚¹æŒ‡å—

#### ä¿®å¤å‰ç«¯é€‰æ‹©å™¨å˜æ›´
```python
# æ–‡ä»¶: app/providers/iask_provider.py
# ä¿®æ”¹å†…å®¹é€‰æ‹©å™¨
await page.wait_for_selector('#text', timeout=60000)  # æ—§é€‰æ‹©å™¨
await page.wait_selector('.new-content-container', timeout=60000)  # æ–°é€‰æ‹©å™¨
```

#### æ·»åŠ æ–°çš„ Provider
```python
# 1. åˆ›å»ºæ–°æ–‡ä»¶: app/providers/new_provider.py
class NewProvider(BaseProvider):
    async def chat_completion(self, request_data: dict):
        # å®ç°ä½ çš„é€»è¾‘
        pass
    
    async def get_models(self):
        # è¿”å›æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨
        return ["model1", "model2"]
```

### ğŸ§ª æµ‹è¯•ä¸éªŒè¯

**API æµ‹è¯•ç¤ºä¾‹**
```bash
# æµ‹è¯•èŠå¤©è¡¥å…¨
curl -X POST "http://localhost:8088/v1/chat/completions" \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "general",
    "messages": [{"role": "user", "content": "ä½ å¥½ï¼Œä¸–ç•Œï¼"}],
    "stream": true
  }'
```

**å¥åº·æ£€æŸ¥**
```bash
curl "http://localhost:8088/health"
```

### ğŸ”§ æ•…éšœæ’é™¤

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| å¯åŠ¨å¤±è´¥ï¼Œç«¯å£è¢«å ç”¨ | ç«¯å£å†²çª | ä¿®æ”¹ `.env` ä¸­çš„ `NGINX_PORT` |
| æµè§ˆå™¨å¯åŠ¨å¤±è´¥ | ç³»ç»Ÿä¾èµ–ç¼ºå¤± | ç¡®ä¿ Docker æ­£å¸¸è¿è¡Œ |
| API è¿”å› 401 | API Key é”™è¯¯ | æ£€æŸ¥ `Authorization` å¤´æ ¼å¼ |
| æµå¼å“åº”å¡é¡¿ | Nginx ç¼“å†² | ç¡®è®¤ `proxy_buffering off` |

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ **Apache 2.0** å¼€æºåè®®ã€‚

### ä½ å¯ä»¥è‡ªç”±åœ°ï¼š
- âœ… **å•†ç”¨** - å°†æœ¬é¡¹ç›®ç”¨äºå•†ä¸šç›®çš„
- âœ… **åˆ†å‘** - å¤åˆ¶å’Œåˆ†å‘é¡¹ç›®å‰¯æœ¬  
- âœ… **ä¿®æ”¹** - ä¿®æ”¹æºä»£ç 
- âœ… **ç§ç”¨** - åœ¨ä¸ªäººé¡¹ç›®ä¸­ä½¿ç”¨

### ä½ éœ€è¦ï¼š
- ğŸ“ **ä¿ç•™ç‰ˆæƒå£°æ˜** - åœ¨åˆ†å‘ä¸­åŒ…å«åŸå§‹è®¸å¯å£°æ˜
- ğŸ“ **å£°æ˜å˜æ›´** - åœ¨ä¿®æ”¹çš„æ–‡ä»¶ä¸­æ˜ç¡®æ ‡æ³¨æ›´æ”¹

### å…¸å‹ä½¿ç”¨åœºæ™¯
```python
# åœ¨ä½ çš„é¡¹ç›®ä¸­è¿™æ ·ä½¿ç”¨
from iask2api import Client

client = Client(
    base_url="http://your-iask-2api-server",
    api_key="your-api-key"
)

# å°±åƒä½¿ç”¨ OpenAI å®˜æ–¹å®¢æˆ·ç«¯ä¸€æ ·
response = client.chat.completions.create(
    model="general",
    messages=[{"role": "user", "content": "ä½ çš„é—®é¢˜"}]
)
```

---

<div align="center">

## ğŸ‰ æ„Ÿè°¢ä½¿ç”¨ iask-2apiï¼

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ Starï¼**

> "æŠ€æœ¯çš„ä»·å€¼ä¸åœ¨äºå…¶æœ¬èº«çš„å¤æ‚ï¼Œè€Œåœ¨äºå®ƒèƒ½å¤Ÿä¸ºå¤šå°‘äººåˆ›é€ å¯èƒ½ã€‚"

**crafted with â¤ï¸ and â˜• by the community, for the community.**

</div>

## ğŸ”— ç›¸å…³é“¾æ¥

- [é¡¹ç›®åœ°å€](https://github.com/lzA6/iask-2api)
- [é—®é¢˜åé¦ˆ](https://github.com/lzA6/iask-2api/issues)
- [æ›´æ–°æ—¥å¿—](https://github.com/lzA6/iask-2api/releases)
- [è®¨è®ºåŒº](https://github.com/lzA6/iask-2api/discussions)

---

<div align="center">

*æœ€åæ›´æ–°: 2024å¹´12æœˆ*  
*æ„¿ä½ çš„æ¯ä¸€æ¬¡ä»£ç æäº¤ï¼Œéƒ½è®©è¿™ä¸ªä¸–ç•Œå˜å¾—æ›´å¥½ä¸€ç‚¹ç‚¹ã€‚*

</div>
